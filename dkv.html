<!doctype html>

<html lang="en">
  

<head>
    <title>DKVBrowser on Ipad</title>
</head>
<body>
 <form  action="#" method="post">
  
   <table>
     <tr><td style="font-weight:bold">Midi</td><td> <input type="text" id="midi" name="midi" tabindex="1" onChange="processMidi(this.value,errors);"></td><td>Examples: 345 or PIANO345.MID </td></tr>
     <tr><td style="font-weight:bold">OR Title</td><td> <input type="text" id="title" name="title"></td></tr>
       <tr><td style="font-weight:bold">Source</td><td> <input type="text" id="source" name="source"></td><td></td></tr>
      <tr><td style="font-weight:bold">Album</td><td> <input type="text" id="album" name="album"></td></tr>
   
    <tr><td style="font-weight:bold">IP</td><td> <input type="text" id="IP" name="IP"></td><td>Where is DKVBrowser running<br/>Blank if on this machine</td></tr>
   </table>
    <input type="submit" value="RUN DKVBrowser with above Values" onclick="errors=0;submitDKV(errors);return false;"><br />
   <h3>Quick Actions</h3>
      <input type="button"  value="Volume Up"  onClick="window.open(dkvurl()+'?volumeUp','_blank')" /> &nbsp;&nbsp;
     <input type="button"  value="Volume Down" onClick="window.open(dkvurl()+'?volumeDown','_blank')" /> &nbsp;&nbsp;
     <input type="button"  value="Pause"  onClick="window.open(dkvurl()+'?Pause','_blank')" /> &nbsp;&nbsp;
      <input type="button"  value="Stop"  onClick="window.open(dkvurl()+'?Stop','_blank')" /> &nbsp;&nbsp;
      <input type="button"  value="Play"  onClick="window.open(dkvurl()+'?Play','_blank')" /> &nbsp;&nbsp;
      <input type="button"  value="Standby"  onClick="window.open(dkvurl()+'?Standby','_blank')" /> &nbsp;&nbsp;
      <input type="button"  value="Connect"  onClick="window.open(dkvurl()+'?Connect','_blank')" /> &nbsp;&nbsp;<br /><br />
   
   <br />
   <br />
 </form>
 <div id="errors" style="overflow-y: auto;height:150px;">
 &nbsp;
 </div>
</body>
<script language="javascript">
var start=function(){
  // document.getElementByID("midi").focus();
   var IP=""
   var parameters=location.search.substring(1).split("&");
   var parmNo=parameters.length;
    var IP="";
   var errors=0;
   if (parmNo>0)  
     for (var i = 0; i < parmNo; i++) {
      test=parameters[i].split("=");
      if ( test[0]=="midi") {
         if (document.getElementById("midi").value>" ") {
            displayWrite("Warning 101: Duplicate Parameter Ignored "+parameters[i]);
        }
        else  {
            processMidi(test[1],errors);
           
            }
      }
      else if (test[0]=="title") {
   
            if (document.getElementById("title").value>" ") {
            displayWrite("Warning 102: Duplicate Parameter Ignored "+parameters[i]);
        }
        else       document.getElementById("title").value = test[1];
              
        }
       else  if (test[0]=="IP") {
            if (document.getElementById("IP").value>" ") {
                displayWrite("Warning 103: Duplicate Parameter Ignored "+parameters[i]);
            }
            else   document.getElementById("IP").value =test[1];
      }
      else if (test[0]=="album") {
      
                if (document.getElementById("album").value>" ") {
                displayWrite("Warning 104: Duplicate Parameter Ignored "+parameters[i]);
            }
            else     document.getElementById("album").setAttribute("value", test[1]);
            }
       else if (test[0]=="source") {
                if (document.getElementById("source").value>" ") {
                displayWrite("Warning 109: Duplicate Parameter Ignored "+parameters[i]);
            }
            else     document.getElementById("source").value = test[1];
        }
       else if (test[0]=="pianoOff")  {alert("piano off");}
     else if (test[0]=="volumeUp")  {}
    
      else if (test[0]=="volumeDown") {} 
      
      else if (test[0]=="pause")  {}
     
      else if((i>0)&&(parameters[i].strlength>0))displayWrite("Warning 106: Unknown parameter  "+ parameters[i]+"--ignored");
      
    }
     
      
   submitDKV(errors);

}
var processMidi=function(test,errors){
           
            midiPart= test.split(".");
            partCount=midiPart.length;
             if (partCount>2) {
                    errors++;
                    displayWrite("Error 206: Too many periods in Midi file name");
                    }
            else if (isInt(midiPart[0])&&(midiPart[0].length==3)&&(partCount==1))  {
                      document.getElementById("midi").value = "PIANO"+test+".MID";
                }
             else    document.getElementById("midi").value =test;
                     
    }
var submitDKV=function(errors){
  
  displayWrite("************ Checking Data ***********************");
  if (document.getElementById("IP").value=="") {
            displayWrite("Warning 105: Missing IP value -- dkvBrowser must be running on this computer");
        }
        var url="";
        var midi=(document.getElementById("midi").value);
        var title=(document.getElementById("title").value);
        var source=(document.getElementById("source").value);
        var album=(document.getElementById("album").value);
        album=album.trim();
        if (album=="") {
             displayWrite("Error: Missing Album");
             errors++;
        }
        source=source.trim();
        if (source=="") {
             displayWrite("Error: Missing Source");
             errors++;
        }
        if((midi.trim()>" ")&&(title.trim()>" ")){
            displayWrite("Warning 106: You have supplied both Midi and Title parameters.  Only the Midi will be used");
            url=dkvurl()+"?midi="+midi.trim()+"&source="+source+"&album="+album;
         }
         else if (midi>" ") url=dkvurl()+"?midi="+midi.trim()+"&source="+source+"&album="+album;
         else if (title>" ") url=dkvurl()+"?title="+title.trim()+"&source="+source+"&album="+album;
         else {
			 displayWrite("Error 205 Missing Title AND Midi");
			 errors++
         
         }
        if (errors==0) {
            window.open(url,'dkv');
            displayWrite("submitting url ="+url);
        }
        else displayWrite("***Cannot submit due to errors.");

       
}
function isInt(value) {
          return !isNaN(value) && 
         parseInt(Number(value)) == value && 
         !isNaN(parseInt(value, 10));
}
function dkvurl(){
      var url= "";
      var IP=document.getElementById("IP").value;
   if (document.getElementById("IP").value>"") url="http://"+IP.trim()+":8081";
   else url="localhost:8081";
   
   return url;
    }
    
function displayWrite(a) {
    if (document.body) {
        var x = document.createElement("div");
        document.getElementById("errors").appendChild(x);
        x.innerHTML = a+"</div>" ;
        var out = document.getElementById("errors");
// allow 1px inaccuracy by adding 1
        var isScrolledToBottom = out.scrollHeight - out.clientHeight <= out.scrollTop + 1;
        /*if(isScrolledToBottom)*/
              out.scrollTop = out.scrollHeight - out.clientHeight;
    }
  
   }
window.onload=start;
</script>
</html>
